<!doctype html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=1280">
	<title>HitBall</title>
	<script src="./js/plugin/jquery-1.9.1.min.js"></script>
	<script src="./js/plugin/jquery.transform.js"></script>
	<script src="./js/plugin/jquery.easing.1.3.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/style.css">
	<script type="text/javascript">
	if (location.href.indexOf(':8000') != -1) document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
	</script>
</head>

<body>
	<div class="blgm_wrap">
		<div class="blgm_in animated">
			<div class="rotate">
				<div class="target_zone targetZone">
					<div class="app_target_ball " style="display: block; width: 40px; height: 40px;"></div>
				</div>
				<div class="target_ball_wrap">
					<div class="target_ball targetBall"></div>
				</div>
			</div>
			<a href="#;" class="target_button targetButton"></a>
			<div class="taScore"></div>
			<div class="taPaul"></div>
			<div class="taOut"></div>
			<div class="taSpeed"></div>
			<div class="taPop"></div>
		</div>
		<!-- 게임 공통 : S -->
		<div id="ybm_game_2_ready" class="game_ready">
			<div>
				<span>How To Play</span>
				<button type="button" id="start_game_2" class="start_game">시작</button>
			</div>
		</div>
		<div id="game_2_next" class="game_over">
			<div>
				<p>
					<em id="game_2_point">100</em><em>포인트</em>가 적립되었습니다.</em>
				</p>
				<button id="game_2_over">다음</button>
			</div>
		</div>
		<!-- 게임 공통 : E -->
		<div class="sound_lst soundPlayLst">
			<audio src="./sound/chuck.mp3" class="sndLst tp01"></audio>
			<audio src="./sound/DingDong.mp3" class="sndLst tp02"></audio>
			<audio src="./sound/result.mp3" class="sndLst tp03"></audio>
		</div>
		<button id="ios_audio_button" class="">사운드 온오프</button>
		<div class="pop_miss popMiss">
			<span class="pop_img popMissImg"></span>
		</div>
	</div>
	<button class="asdf">asdfsdf</button>
	<button class="bbbbb">asdfsdf</button>
	<style type="text/css">
	.asdf {
		position: relative;
	}
	</style>
	<script type="text/javascript">
	test = {
		loop: null,
		dir: 2, //1 : 우측하단 , 2: 좌측상단
		vvx: 0,
		vvy: 0,
		vx: 0,
		vy: 0,
		gravity: .05,
		test: 0,
		init: function($this) {
			var _this = this;
			this.el = $this;
			this.update();
			$('.bbbbb').click(function() {
				_this.test = 1;
			});
		},
		move: function() {
			this.el.css({
				'left': this.vvx,
				'top': this.vvy,
			});
		},
		update: function() {
			var _this = this;
			var pos = {
				x: _this.el[0].offsetLeft,
				y: _this.el[0].offsetTop
			};
			var x = 1;
			var y = 1;
			console.log(y + _this.gravity);
			this.loop = setInterval(function() {
				if (_this.vvy > 100) {
					y += _this.gravity
				}
				_this.vvx += x;
				_this.vvy += y;
				_this.move();
			}, 100);
		},
	};
	$('.asdf').click(function() {
		test.init($(this));
	}).click();
	//var gamePath = Game.gamePath[Game.gameCode]; //폴더경로 변경값
	var HitBall = function(obj) {
		this.obj = $.extend(true, {
			targetZone: '.targetZone',
			targetZoneSize: 100,
			maxGamePoint: 25,
			targetBall: '.targetBall',
			targetBallSize: 40,
			level: 1,
			ranBallCount: 5,
			keybind: 32,
			maxOutCount: 50,
		}, obj);
		this.targetButton = '.targetButton';
		this.appTargetBall = '.appTargetBall';
		this.targetZoneOffset = {};
		this.targetBallOffset = {};
		this.exclevel = 0;
		this.crrtCls = 0;
		this.retimeBall = 1500;
		this.gamePoint = 0;
		this.ballCount = 0;
		this.ballScore = 0;
		this.ballOut = 0;
		this.ballSpeed = 0;
		this.ballOutBool = false;
		this.ballPaul = 0;
		this.iniBallSpeed = 80;
		this.taScore = '.taScore';
		this.taPaul = '.taPaul';
		this.taOut = '.taOut';
		this.taSpeed = '.taSpeed';
		this.taTextArry = ['홈런', '안타', '아웃', '파울'];
		this.loop = function() {};
		this.sound = {
			bool: true,
			el: '.soundPlayLst',
			onoff: '#ios_audio_button',
			//물엇을때 , 성공햇을때, 포인트
			lst: ['.sndLst.tp01', '.sndLst.tp02', '.sndLst.tp03'],
		};
		this.init();
	};
	HitBall.prototype = {
		init: function() {
			this.setSound();
			this.set();
			this.bind();
		},
		set: function() {
			var _this = this;
			this.targetOffset().zone();
			this.targetBallMoveAfter();
			this.targetBallMove(this.obj.level);
		},
		bind: function() {
			var _this = this;
			$(document).keyup(function(e) {
				if (e.keyCode == _this.obj.keybind) {
					_this.targetEffect();
				}
			});
			$(this.targetButton).off().on({
				'click': function() {
					_this.targetEffect();
				}
			});
		},
		targetEffect: function() {
			var z = this.targetZoneOffset;
			var b = this.targetBallOffset;
			if (b.left >= z.left && b.right <= z.right) {
				this.crrtCls = 1;
			} else if ((b.left + (this.obj.targetBallSize / 2)) >= z.left && (b.right - (this.obj.targetBallSize / 2)) <= z.right) {
				this.crrtCls = 2;
			} else if (b.left < (z.left - this.obj.targetBallSize) || b.right > (z.right + this.obj.targetBallSize)) {
				this.crrtCls = 3;
			} else {
				this.crrtCls = 4;
			}
			this.ballOutBool = false;
			if (this.crrtCls != 3) {
				$(this.obj.targetZone).append('<div class="app_target_ball ' + this.clsFormat(this.appTargetBall) + '" style="width: ' + this.obj.targetBallSize + 'px; height: ' + this.obj.targetBallSize + 'px; " data-act-ball="' + this.ballCount + '"></div>');
			}
			this.targetEffectCallb();
		},
		targetEffectCallb: function() { //1 : 홈런 , 2: 안타 ,3:아웃,4:파울
			var _this = this;
			var clsn = '';
			switch (this.crrtCls) {
				case 1: //홈런
					this.ballScore += 100;
					clsn = 'homerun';
					break;
				case 2: //안타
					this.ballScore += 10;
					clsn = 'anta01';
					break;
				case 3: //아웃
					this.ballOut += 1;
					break;
				case 4: //파울
					this.ballPaul += 1;
					if (this.ballPaul == 2) {
						this.ballOut += 1;
						this.ballPaul = 0;
					}
					clsn = 'paul01';
					break;
			}
			$(this.appTargetBall + '[data-act-ball="' + this.ballCount + '"]').show().addClass(clsn);
			$('.taPop').text(this.taTextArry[this.crrtCls - 1]);
		},
		aniCallb: function(cf) {
			return $.extend(false, {
				'duration': 300,
				'easing': 'swing',
				'complete': function() {},
			}, cf);
		},
		targetBallMoveAfter: function() {
			$(this.taScore).text(this.ballScore);
			$(this.taOut).text(this.ballOut);
			$(this.taPaul).text(this.ballPaul);
			$(this.taSpeed).text(this.ballSpeed);
		},
		excLevelFun: function(lv) {
			var lv = Math.round(lv);
			var maxlv = lv + lv;
			var arry = [];
			for (var i = 0; i <= maxlv; i++) {
				arry.push(i);
			}
			var rand = Math.floor(Math.random() * arry.length);
			this.exclevel = this.obj.level + (arry[rand] / arry.length);
			this.ballSpeed = Math.round(((arry[rand] / arry.length) + 1) * this.iniBallSpeed);
		},
		targetBallMove: function() {
			var _this = this;
			var bool = true;
			var cnt = 0;
			this.exclevel = this.obj.level;
			this.ballOutBool = true;
			this.excLevelFun(this.obj.ranBallCount);
			clearInterval(this.loop);
			if (this.ballOut >= this.obj.maxOutCount) {
				//this.gameFinishFun();
				return;
			}
			this.ballCount++;
			this.loop = setInterval(function() {
				$(_this.obj.targetBall).css({
					'left': cnt,
				});
				cnt += _this.exclevel + Math.abs(cnt * .02);
				_this.targetOffset().ball();
				var z = _this.targetZoneOffset;
				var b = _this.targetBallOffset;
				if ((b.left >= z.left && b.right <= z.right) || ((b.left + (_this.obj.targetBallSize / 2)) >= z.left && (b.right - (_this.obj.targetBallSize / 2)) <= z.right)) {
					$('.targetZone').css('background', 'green');
				} else {
					$('.targetZone').css('background', 'red');
				}
				if (cnt >= _this.targetZoneOffset.right) {
					$(_this.obj.targetBall).animate({
						'opacity': 0,
						'left': cnt
					}, {
						'duration': 300,
						'complete': function() {
							$(this).css({
								'left': 0,
								'opacity': 1,
							});
							if (_this.ballOutBool) {
								_this.crrtCls = 3;
								_this.targetEffectCallb(3);
							}
						}
					});
					_this.targetOffset().ball(false);
					clearInterval(_this.loop);
					setTimeout(function() {
						_this.targetBallMove();
					}, _this.retimeBall);
				}
			}, 15 / this.exclevel);

			this.targetBallMoveAfter();
		},
		targetOffset: function() {
			var _this = this;
			return {
				zone: function() {
					_this.targetZoneOffset = this.extendFun($(_this.obj.targetZone), _this.obj.targetZoneSize);
				},
				ball: function(bool) {
					if (bool == false) {
						_this.targetBallOffset = { left: 0, right: 0, top: 0, bottom: 0 };
						return;
					}
					_this.targetBallOffset = this.extendFun($(_this.obj.targetBall), _this.obj.targetBallSize);
				},
				extendFun: function(z, b) {
					return $.extend({ left: 0, right: 0, top: 0, bottom: 0 }, _this.targetSet(z, b));
				}
			};
		},
		targetSet: function($el, size) {
			var _this = this;
			$el.css({
				'width': size,
				'height': size
			});
			return {
				left: $el[0].offsetLeft,
				right: $el[0].offsetLeft + size,
				top: $el[0].offsetTop,
				bottom: $el[0].offsetTop + size
			};
		},
		gameFinishFun: function(bool) {
			this.gameFinish = true;
			this.gamePiontFun();
			$('#game_2_point').text(this.gamePoint);
			$('#game_2_next').show();
		},
		gamePiontFun: function() {
			this.getSound(this.sound.lst[2]);
			this.gamePoint = Math.round((this.ballScore / (this.ballCount * 100)) * this.obj.maxGamePoint);
			Game.point = this.gamePoint;
		},
		setSound: function() {
			var _this = this;
			var button = '';
			$(this.sound.onoff).off().on('click', function() {
				$(this).toggleClass('off');
				if ($(this).is('.off')) {
					_this.sound.bool = false;
				} else {
					_this.sound.bool = true;
				}
			});
			for (var i = 0; i < this.sound.lst.length; i++) {
				$(this.sound.lst[i]).attr('data-sudfile', i);
				button += '<button data-sudbutton="' + i + '" class="hidden" type="button">오디오버튼</button>';
			}
			$(this.sound.el).append(button);
		},
		getSound: function(el) {
			if (this.sound.bool) {
				var $el = $(el);
				var $data = $el.data('sudfile');
				$el[0].muted = false;
				$('[data-sudbutton="' + $data + '"]').off().on('click', function() {
					$('[data-sudfile="' + $data + '"]')[0].play();
				}).click();
			}
		},
		clsFormat: function(cls) {
			return cls.replace('.', '');
		},
	};


	var Game = {
		callback: function() {}
	};
	var hitball = null;
	$('#start_game_2').off().on('click', function() {
		$('#ybm_game_2_ready').hide();
		hitball = new HitBall();
	}).click();
	//끝났을때
	//cny 마지막 Next버튼 클릭시 LMS에 값 저장하기
	$('#game_2_over').off().click(function() {
		Game.saved = callback(Game.gameCode, Game.schedIndex, Game.seqNo, Game.point);
		if (Game.saved) {
			Game.ending();
		} else {
			if (confirm("통신상태가 원할하지 못해 게임점수가 저장되지 않았습니다.\n그래도 진행하시겠습니까?")) Game.ending();
		}
	});
	</script>
</body>

</html>